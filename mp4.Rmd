---
title: "mp4"
author: "Julia Lee, Stella Li, Irene Ryan"
date: "4/23/2018"
output: 
  html_document:
    theme: cosmo 
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(mosaic)
```


```{r, message=FALSE, warning=FALSE}
db<-dbConnect_scidb(dbname = "imdb")
dbListTables(db)
```


```{r, message=FALSE, warning=FALSE}
remakesoriginals<-db %>%
dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, mi3.info AS Budget, 'original' AS type, mi4.info AS Languages
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_link AS L on L.linked_movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info AS mi4 ON mi4.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
# used index here
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 105
AND mi4.info = 'English'
AND mi1.info >25000
group by t.id;") 
View(remakesoriginals)


fav_stats(remakesoriginals$votes)

```


```{r, message=FALSE, warning=FALSE}
list<-remakesoriginals%>%
  group_by(title)%>%
  summarise(number=n())%>%
  filter(number==2)

test<-list%>%
  inner_join(remakesoriginals, by="title")

finallist<-test%>%
  group_by(title)%>%
  summarise(distinctyr=n_distinct(production_year))%>%
  filter(distinctyr==2)

mp4<-finallist%>%
  inner_join(remakesoriginals, by="title")%>%
  select(-type)
mp4$votes <-as.numeric(mp4$votes)
mp4$rating <-as.numeric(mp4$rating)
```


```{r, message=FALSE, warning=FALSE}
# deleting the original movie
remakesmp4 <- mp4[c(rep(FALSE,1),TRUE), ]
# deleting the remakes
originalsmp4<-mp4[c(rep(TRUE,1), FALSE),]

# join the two df and create a new column represents the difference in vote and rating
full<-remakesmp4%>%
  left_join(originalsmp4, by="title") %>%
  mutate (diff_rating = rating.x - rating.y) %>%
  mutate (diff_votes = votes.x - votes.y)

plottingdata<-full[-c(65,44 ),]
```


```{r, message=FALSE, warning=FALSE}
# visualization
plot1<- ggplot(data = plottingdata, aes(x=title, y=rating.y))+
  geom_point(color="red")+
  geom_point(aes(y=rating.x), color="blue")+
  theme(text = element_text(size=7),
        axis.text.x = element_text(angle = 90, hjust = 1))
plot1
```


```{r}
ggplot(data = full, aes(x=diff_rating, y = diff_votes)) + 
  geom_point() +
  geom_jitter()
```









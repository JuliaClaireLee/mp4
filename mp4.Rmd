---
title: "mp4"
author: "Julia Lee, Stella Li, Irene Ryan"
date: "4/23/2018"
output: 
  html_document:
    theme: cosmo 
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(mosaic)
```


```{r}
db<-dbConnect_scidb(dbname = "imdb")
dbListTables(db)
```

#Worst movies ordered by rating

```{r}
bestmovies<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, mi3.info AS gross, n.name AS director, n2.name AS writer 
FROM title t
Join cast_info AS ci on ci.movie_id = t.id
Join cast_info AS ci2 on ci2.movie_id = t.id
JOIN name AS n2  on n2.id = ci2.person_id
JOIN name AS n  on n.id = ci.person_id
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 107
  AND ci.role_id = 8
  AND ci2.role_id = 4 
  AND mi1.info > 100000
  AND t.production_year > 1970
GROUP BY t.title
ORDER BY mi2.info DESC
LIMIT 100;")

```

parsing gross for 50 shades

```{r}
fiftyshadesgross<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, mi3.info AS gross
FROM title t
Join cast_info AS ci on ci.movie_id = t.id
Join cast_info AS ci2 on ci2.movie_id = t.id
JOIN name AS n2  on n2.id = ci2.person_id
JOIN name AS n  on n.id = ci.person_id
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 107
  AND ci.role_id = 8
  AND ci2.role_id = 4 
  AND mi1.info > 100000
  AND t.production_year > 2000
ORDER BY mi2.info
LIMIT 26;")


usaparse <- fiftyshadesgross %>%
  filter(grepl("\\(USA\\)", gross))


parsedgross<-usaparse %>%
  mutate(gross_string = str_extract(gross, "^\\$[0-9]+,[0-9]{3},[0-9]{3}"),
         gross = parse_number(gross_string))


parsed<- usaparse%>%
  mutate(the_date_string = str_extract(gross, "\\([0-9]+ [A-Za-z]+ [0-9]{4}\\)"), the_date = parse_datetime(the_date_string, format = "(%d %B %Y)")) %>%
  mutate(gross_string = str_extract(gross, "^\\$[0-9]+,[0-9]{3},[0-9]{3}"),
         gross = parse_number(gross_string)) %>%
  arrange(desc(gross))

ggplot(data=parsed, aes(x=the_date, y=gross))+
         geom_line()
```

# worst sequels

```{r}
sequels<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, n.name AS director, mi3.info AS Budget 
FROM title t
Join cast_info AS ci on ci.movie_id = t.id
JOIN name AS n  on n.id = ci.person_id
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 105
  AND ci.role_id = 8
AND t.title = 'Men in Black II'
OR t.title = 'The Hangover Part II'
OR t.title = 'Star Wars: Episode V - The Empire Strikes Back'
OR t.title = 'Jurassic Park II'
OR t.title = 'The Dark Knight'
OR t.title = 'Star Trek II: The Wrath of Khan'
OR t.title = 'Temple of Doom'
OR t.title = 'The Godfather: Part II'
OR t.title =  'Toy Story 2'
OR t.title =  'T2'
OR t.title = 'Blade Runner 2049'
OR t.id = 695024
OR t.title = 'The Lord of the Rings: The Two Towers'
group by t.title
ORDER BY mi2.info;")
View(sequels)
```

Batman Begins and The Dark Knight

The Godfather and the Godfather II

The Lion King and Lion King 2: Simba's Pride

Lord of the Rings The Fellowship of the Ring and The Two Towers

Star Wars A New Hope and Star Wars The Empire Strikes Back

The Matrix and The Matrix Reloaded

Alien and Aliens

Blade Runner and Blade Runner 2049

Indiana Jones Raiders of the Lost Arc and Temple of Doom

Trainspotting and T2

Star Trek and Star Trek II: The Wrath of Khan

Jurassic Park 1 and 2

Toy Story and Toy Story 2

Men in Black I and II

The Hangover Part 1 and 2



```{r}
Remakes_and_orginals<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, mi3.info AS Budget
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_link AS L on L.movie_id = t.id
JOIN movie_link AS L2 on L2.Linked_movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 105
AND L.link_type_id = 3
group by t.id
Limit 100;") 
View(Remakes)
```

```{r}
orginals<-db %>%
dbGetQuery("SELECT t.id, t.title, t.production_year, 
  mi1.info AS votes, mi2.info AS rating, n.name AS director, mi3.info AS Budget 
FROM title t
Join cast_info AS ci on ci.movie_id = t.id
JOIN name AS n  on n.id = ci.person_id
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_link AS L on L.linked_movie_id = t.id
JOIN movie_info AS mi3 ON mi3.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
WHERE t.kind_id = 1
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi3.info_type_id = 105
  AND ci.role_id = 8
order by t.id
Limit 100;") 
View(orginals)

```




